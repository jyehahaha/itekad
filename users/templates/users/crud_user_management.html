{% extends 'users/master/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %} iTekad - User Management{% endblock title %}
{% block css %}{% endblock css %}

{% block content %}

{% if form1.errors %}
{% for field in form1 %}
  {% for error in field.errors %}
    <p> {{ error }} </p>
  {% endfor %}
{% endfor %}
{% endif %}

{% if form2.errors %}
{% for field in form2 %}
  {% for error in field.errors %}
    <p> {{ error }} </p>
  {% endfor %}
{% endfor %}
{% endif %}


<div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">General Details</div>
{% if view == 'create' %}
<form method="POST">
  <div class="row">
    {% csrf_token %}
    <div class="col-6">
      {{ form1.first_name|as_crispy_field }}
    </div>
    <div class="col-6">
      {{ form1.last_name|as_crispy_field }}
    </div>
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          {% csrf_token %}
          {{ user_form.as_p }}
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Full Name</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Full Name">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Username</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Username">
              </td>
              <th width="15%" class="align-middle">MyKad No.</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="MyKad No.">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Email Address</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Email Address">
              </td>
              <th width="15%" class="align-middle">Mobile No.</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Mobile No.">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 1</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 1">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 2</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 2">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 3</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 3">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Postcode</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Postcode">
              </td>
              <th width="15%" class="align-middle">City</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="City">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">State</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="State">
              </td>
              <th width="15%" class="align-middle">Country</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="" value="Malaysia">
              </td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>

  <div class="mb-3"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Account Details</div>
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          {{ profile_form.as_p }}
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Bank Name</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Bank Name">
              </td>
              <th width="15%" class="align-middle">Bank Account No.</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Bank Account No.">
              </td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>

  <div class="mt-5"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Role Details</div>
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Role</th>
              <td width="35%">
                <select class="form-select">
                  <option selected>-- Select --</option>
                  <option value="1">Admin</option>
                  <option value="2">Entreprenuer</option>
                  <option value="3">Investor</option>
                </select>
              </td>
              <th width="15%" class="align-middle">Category</th>
              <td width="35%">
                <select class="form-select">
                  <option selected>-- Select --</option>
                  <option value="1">Reviewer</option>
                  <option value="2">Approver</option>
                </select>
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Status</th>
              <td width="35%">
                <select class="form-select">
                  <option selected>-- Select --</option>
                  <option value="1">Active</option>
                  <option value="2">Not Active</option>
                </select>
              </td>
              <th width="15%" class="align-middle"></th>
              <td width="35%"></td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>

  <div class="mt-5"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Password Details</div>
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Password</th>
              <td width="35%" class="align-middle">
                <input type="text" class="form-control" placeholder="Password">
              </td>
              <th width="15%" class="align-middle">Confirm Password</th>
              <td width="35%" class="align-middle">
                <input type="text" class="form-control" placeholder="Confirm Password">
              </td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>
  <div class="mb-3"></div>
  <div class="row">
    <div class="col-12 text-end">
      <a href="{% url 'user_management_page' %}" type="button" class="btn btn-secondary" style="width: 100px;"><i
          class='bx bx-chevron-left bx-pull-left bx-sm'></i>Cancel</a>
      <button class="btn btn-warning" type="submit" style="width:100px;"><i
          class='bx bx-edit bx-pencil bx-pull-left bx-sm'></i>Create</button>
    </div>
  </div>
</form>
{% elif view == 'update' %}
<form method="POST">
  {% csrf_token %}
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          {{ form.as_p }}
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Username</th>
              <td width="35%">
                <input type="text" name="username" class="form-control"  placeholder="Username" value="{{ form.username.value }}">
              </td>
              <th width="15%" class="align-middle">Email Address</th>
              <td width="35%">
                <input type="text" name="email" class="form-control" placeholder="Email" value="{{ form.email.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">First Name</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="First Name" name="first_name" value="{{ form.first_name.value }}">
              </td>
              <th width="15%" class="align-middle">MyKad No.</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Mykad No." name="mykad_no" value="{{ profile_form.mykad_no.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Mobile No.</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Mobile No." name="mobile_no" value="{{ profile_form.mobile_no.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 1</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 1" name="address_line_one" value="{{ profile_form.address_line_one.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 2</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 2" name="address_line_two" value="{{ profile_form.address_line_two.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Address Line 3</th>
              <td width="35%" colspan="3">
                <input type="text" class="form-control" placeholder="Address Line 3" name="address_line_three" value="{{ profile_form.address_line_three.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Postcode</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="Postcode" name="postcode" value="{{ profile_form.postcode.value }}">
              </td>
              <th width="15%" class="align-middle">City</th>
              <td width="35%">
                <input type="text" class="form-control" placeholder="City" name="city" value="{{ profile_form.city.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">State</th>
              <td width="35%">
                <input type="text" class="form-control" name="state" value="{{ profile_form.state.value }}">
              </td>
              <th width="15%" class="align-middle">Country</th>
              <td width="35%">
                <input type="text" class="form-control" name="country" value="{{ profile_form.country.value }}">
              </td>
            </tr>
          </tbody> -->
        </table>

      </div>
    </div>
  </div>

  <div class="mb-3"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Account Details</div>
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          {{ profile_form.as_p }}
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Bank Name</th>
              <td width="35%">
                <input type="text" class="form-control" name="bank_name" value="{{ profile_form.bank_name.value }}">
              </td>
              <th width="15%" class="align-middle">Bank Account No.</th>
              <td width="35%">
                <input type="text" class="form-control" name="bank_account_number" value="{{ profile_form.bank_account_number.value }}">
              </td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>
  <div class="mb-3"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Role Details</div>
  <div class="row">
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Role</th>
              <td width="35%">
                <select class="form-select">
                  <option value="{{ profile_form.role.value }}">{{ profile_form.role }}</option>
                </select>
              </td>
              <th width="15%" class="align-middle">Category</th>
              <td width="35%">
                <select class="form-select">
                  <option selected>-- Select --</option>
                  <option value="1">Reviewer</option>
                  <option value="2">Approver</option>
                </select>
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Status</th>
              <td width="35%">
                <select class="form-select">
                  <option selected>-- Select --</option>
                  <option value="1">Active</option>
                  <option value="2">Not Active</option>
                </select>
              </td>
              <th width="15%" class="align-middle"></th>
              <td width="35%"></td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>

  <div class="mb-3"></div>
  <div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Password Details</div>
  <div class="row">
    <div class="col-12 text-end">
      <a href="#" type="button" class="btn btn-secondary"><i class='bx bx-mail-send bx-pull-left bx-sm'></i>Send Link
        Reset Password</a>
      <div class="mb-3"></div>
    </div>
    <div class="col-12">
      <div class="table-responsive">
        <table class="table table-light">
          <!-- <tbody>
            <tr>
              <th width="15%" class="align-middle">Password</th>
              <td width="35%" class="align-middle">
                <input type="password" class="form-control" placeholder="Password" name="password1" value="{{ form.password1.value }}">
              </td>
              <th width="15%" class="align-middle">Confirm Password</th>
              <td width="35%" class="align-middle">
                <input type="password" class="form-control" placeholder="Confirm Password" name="password2" value="{{ form.password2.value }}">
              </td>
            </tr>
            <tr>
              <th width="15%" class="align-middle">Last Reset</th>
              <td width="35%" class="align-middle">
                <input type="date" class="form-control" placeholder="">
              </td>
              <th width="15%" class="align-middle"></th>
              <td width="35%" class="align-middle"></td>
            </tr>
          </tbody> -->
        </table>
      </div>
    </div>
  </div>

  
  <div class="mb-3"></div>
  <div class="row">
    <div class="col-12 text-end">
      <a href="{% url 'user_management_page' %}" type="button" class="btn btn-secondary" style="width: 100px;"><i
          class='bx bx-chevron-left bx-pull-left bx-sm'></i>Cancel</a>
      <button class="btn btn-warning" type="submit" style="width:100px;"><i
          class='bx bx-edit bx-pencil bx-pull-left bx-sm'></i>Update</button>
    </div>
  </div>
</form>
{% elif view == 'details' %}
<div class="row">
  <div class="col-12">
    <div class="table-responsive">
      <table class="table table-light">
        <tbody>
          <tr>
            <th width="15%">Username</th>
            <td width="35%">{{ user_record.username }}</td>
            <th width="15%">Email Address</th>
            <td width="35%">{{ user_record.email }}</td>
          </tr>
          <tr>
            <th>Full Name</th>
            <td>{{ user_record.get_full_name }}</td>
            <th>MyKad No.</th>
            <td>{{ user_profiel_record.mykad_no }}</td>
          </tr>
          <tr>
            <th>Address</th>
            <td colspan="3">{{ user_profile_record.address_line_one }}</td>
          </tr>
          <tr>
            <th></th>
            <td colspan="3">{{ user_profile_record.address_line_two }}</td>
          </tr>
          <tr>
            <th></th>
            <td colspan="3">{{ user_profile_record.address_line_three }}</td>
          </tr>
          <tr>
            <th></th>
            <td colspan="3">Wilayah Persekutuan K. L., Malaysia</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="mb-3"></div>
<div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Account Details</div>
<div class="row">
  <div class="col-12">
    <div class="table-responsive">
      <table class="table table-light">
        <tbody>
          <tr>
            <th width="15%">Bank Name</th>
            <td width="35%">{{ user_profile_record.bank_name }}</td>
            <th width="15%">Account No.</th>
            <td width="35%">{{ user_profile_record.bank_account_number }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mb-3"></div>
<div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Role Details</div>
<div class="row">
  <div class="col-12">
    <div class="table-responsive">
      <table class="table table-light">
        <tbody>
          <tr>
            <th width="15%">Role</th>
            <td width="35%">{{ user_profile_record.role }}</td>
            <th width="15%">Category</th>
            <td width="35%">-</td>
          </tr>
          <tr>
            <th width="15%">Status</th>
            <td width="35%">{{ user_record.is_active }}</td>
            <th width="15%"></th>
            <td width="35%"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="mb-3"></div>
<div class="h4 pb-2 mb-4 text-dark border-bottom border-dark">Password Details</div>
<div class="row">
  <div class="col-6">
    <label class="form-label">Password Expiry</label>
    <input type="text" class="form-control"  value="-" disabled>
  </div>
  <div class="col-6">
    <label class="form-label">Last Reset</label>
    <input type="text" class="form-control"  value="-" disabled>
  </div>
  <div class="col-12">
    <label class="form-label">Status</label>
    <input type="text" class="form-control"  value="-" disabled>
  </div>
</div>
<div class="mb-3"></div>
<div class="row">
  <div class="col-12 text-end">
    <a href="{% url 'user_management_page' %}" type="button" class="btn btn-secondary" style="width: 100px;"><i
        class='bx bxs-chevron-left bx-pull-left bx-sm'></i>Back</a>
    <a href="{% url 'update_user_management_page' 1 %}" class="btn btn-warning" type="button" style="width: 100px;"><i
        class='bx bx-edit bx-pull-left bx-sm'></i>Edit</a>
  </div>
</div>
{% endif %}
{% endblock %}

{% block js%}
<script>
  new DataTable('#tblTranche');
  new DataTable('#tblDetailsTranche');
  new DataTable('#tblUpdateTranche', {
    columnDefs: [
      {
        orderable: false,
        className: 'select-checkbox',
        targets: 0
      }
    ],
    select: {
      style: 'multi',
      selector: 'td:first-child'
    },
    order: [[1, 'asc']]
  });

  new DataTable('#tblAssignTranche', {
    columnDefs: [
      {
        orderable: false,
        className: 'select-checkbox',
        targets: 0
      }
    ],
    select: {
      style: 'multi',
      selector: 'td:first-child'
    },
    order: [[1, 'asc']]
  });


$(document).ready(function() {
     // Initially hide the position field if it's empty
    var positionField = $('#id_position');
    var positionContainer = positionField.closest('.col-12');
    if (positionField.val().trim() === '') {
        positionContainer.hide();
    }

    // Function to show/hide position field based on role selection
    $('#id_role').change(function() {
        if ($(this).val() === 'ADMIN') {
            positionContainer.show();
        } else {
            if (positionField.val().trim() === '') {
                positionContainer.hide();
            }
        }
    });

    $('#id_terms_agreement').attr('checked', true);
    // $('#id_terms_agreement').prop('checked');
});

</script>

{% endblock js%}